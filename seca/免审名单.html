<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link href="<?=BACK_CSS_Basic_Layout?>" rel="stylesheet" type="text/css">
    <link href="<?=BACK_CSS_Common_Style?>" rel="stylesheet" type="text/css">
    <link href="<?=SITE_CSS.'baidu/bootstrap.min.css'?>" rel="stylesheet">
    <title>播8后台系统</title>
    <style>
        .alt td{ background:black !important;}
    </style>
</head>
<body>

<div >
    <!-- 按钮触发模态框 -->
    <button class="btn btn-primary btn-lg btn-room-add" data-toggle="modal" data-target="#roomModal">添加直播间</button>
</div>
<br>
<div class="ui_content">
    <div class="ui_tb">
        <table class="table" cellspacing="1" cellpadding="1" width="100%" align="center" border="0">
            <tr>
                <th>免审核直播间</th>
                <th>是否可以投票</th>
                <th>操作</th>
            </tr>
            <?php
            foreach($data as $k=>$v){
                ?>
                <tr>
                    <td class="js-user" data-uid="<?=$k?>"></td>
                    <td class="js-is-vote" data-uid="<?=$k?>"><?=$v == 1 ? '是' : '否' ?></td>
                    <td>
                        <button class="btn btn-primary btn-xs js-update" data-val="<?=$k?>"  room_num  vote="<?=$v?>" data-toggle="modal" data-target="#roomUpdateModal">修改直播间</button>
                        <span class="js-del" data-val="<?=$k?>">【删除】</span>
                    </td>
                </tr>
            <?php } ?>
        </table>
    </div>
</div>


<!-- 模态框（Modal） 新建-->
<div class="modal fade" id="roomModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
    <div class="modal-dialog">
        <div class="modal-content" style="width: 400px; ">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">添加直播间</h4>
            </div>
            <br />
            <div class="form-group">
                <h5 for="roomNum" class="col-sm-12 control-label">直播间号</h5>
                <div class="col-sm-12">
                    <input type="text" class="form-control" id="roomNum" placeholder="请输入房间号">
                </div>
            </div>
            <div class="form-group">
                <h5  class="col-sm-12 control-label">是否可以投票</h5>
                <div >
                    <span class="col-sm-1"></span>
                    <input type="radio" name="isVote" id="isVote" value="1"/>
                    <span>是</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <input type="radio" name="isVote" id="noVote" checked="checked" value="0" />
                    <span>否</span>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary " id="btn-room-new-add">添加</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>

<!-- 模态框（Modal） 修改-->
<div class="modal fade" id="roomUpdateModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
    <div class="modal-dialog">
        <div class="modal-content" style="width: 400px;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">添加直播间</h4>
            </div>
            <br />
            <div class="form-group">
                <h5 for="roomEditNum" class="col-sm-12 control-label">直播间号</h5>
                <div>
                    <span class="col-sm-1"></span><span class="col-sm-1" id="roomEditNum"></span>
                </div>
            </div>
            <div class="form-group" style="padding-top: 10px;">
                <h5  class="col-sm-12 control-label">是否可以投票</h5>
                <br>
                <div >
                    <span class="col-sm-1"></span>
                    <input type="radio" name="isEditVote" id="is-EditVote" value="1"/>
                    <span>是</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <input type="radio" name="isEditVote" id="no-EditVote"  value="0" />
                    <span>否</span>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary " id="btn-room-new-update" user_id>修改</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>

<p>&nbsp;&nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;&nbsp;</p>
<script src="<?=SITE_JS.'baidu/jquery.js'?>"></script>
<script type="text/javascript" src="<?=SITE_JS.'common.js'?>"></script>
<script src="<?=SITE_JS.'baidu/bootstrap.min.js'?>"></script>
<script>
    $(document).ready(function () {
        roomJump.init();
    });

    var roomJump = {
        init: function () {
            this.initEvent();
        },
        initEvent: function () {
            $("#btn-add").on("click", function () { roomJump.add(); });
            $("#btn-room-new-add").on("click", function () { roomJump.addroom(); });
            //修改展示
            $(".js-update").on("click",function () {
                $("#roomEditNum").text($(this).attr('room_num'));
                $("#btn-room-new-update").attr('user_id',$(this).attr('data-val'));
                var isVote = $(this).attr('vote');
                if(isVote == 1 ){
                    $('#is-EditVote').attr('checked',true);
                    $("#no-EditVote").removeAttr("checked");
                }else{
                    $('#no-EditVote').attr('checked',true);
                    $("#is-EditVote").removeAttr("checked");
                }
            })

            $("#btn-room-new-update").on("click", function () {
                roomJump.updateroom( $(this).attr('user_id'));
            });

            $(".js-del").css("cursor", "pointer");
            $(".js-del").on("click", function () {
                roomJump.del($(this).attr("data-val"));
            });

            var arrUid = "";
            $(".js-user").each(function () {

                arrUid = (arrUid == "") ? $(this).attr("data-uid") : arrUid + "," + $(this).attr("data-uid");

            });

            if (arrUid != "") {
                roomJump.setUserData(arrUid);
            }
        },
        setUserData: function (arrUid) {
            b8_common._ajax("/backend/user/getuserlist", { uid: arrUid }, function (data) {
                if (data) {
                    var o;
                    for (var l in data) {
                        $(".js-user[data-uid='" + data[l]["uid"] + "']").html(
                            '用户ID：' + data[l]["uid"] +
                            '<br/>房间号：' + data[l]["rnum"] +
                            '<br/>用户名：' + data[l]["uname"]
                        );

                        $(".js-tourl[data-uid='" + data[l]["uid"] + "']").attr("href", "/" + data[l]["rnum"]);
                        $(".js-update[data-val='" + data[l]["uid"] + "']").attr('room_num',data[l]["rnum"]);
                    }
                }
            });
        },
        add: function () {
            var rnum = $("#rnum").val();
            var divObj = $("#div-oper");

            if (rnum.length < 1) {
                divObj.html("请输入要设置的直播间");
                return;
            }

            divObj.html("处理中。。。");
            b8_common._ajax("/backend/discover/addnoapplaypurview", { rnum: rnum }, function (ret) {
                if (ret["ret"] == "0") {
                    divObj.html("<span style='color:blue;'>添加成功</span>");
                    window.setTimeout(function () { window.location.reload(); }, 1500);
                } else {
                    divObj.html("<span style='color:red;'>" + decodeURIComponent(ret["desc"]) + "</span>");
                }
            });
        },
        del: function (uid) {
            var span = $(".js-del[data-val='" + uid + "']");
            span.html("删除中。。。");
            b8_common._ajax("/backend/discover/delnoapplaypurview", { uid: uid }, function (ret) {
                span.html("<span style='color:blue;'>删除成功</span>");
                window.setTimeout(function () { window.location.reload(); }, 1500);
            });

        },
        addroom: function () {
            var roomNum = $("#roomNum").val();
            var isVote =$('input[name=isVote]:checked').val();
            if (roomNum.length < 1) {
                alert("请输入要设置的直播间");
                return ;
            }
            b8_common._ajax("/backend/discover/addnoapplaypurview", { rnum: roomNum,isVote: isVote }, function (ret) {
                if (ret["ret"] == "0") {
                    alert("添加成功");
                    window.setTimeout(function () { window.location.reload(); }, 500);
                } else {
                    alert(decodeURIComponent(ret["desc"]));
                    return ;
                }
            });
        },
        updateroom:function (userId) {
            var isVote  = $('input[name=isEditVote]:checked').val();
            b8_common._ajax("/backend/discover/updatenoapplaypurview", { userId: userId, isVote: isVote }, function (ret) {
                if (ret["ret"] == "0") {
                    alert("修改成功");
                    window.setTimeout(function () { window.location.reload(); }, 500);
                } else {
                    alert(decodeURIComponent(ret["desc"]));  return ;
                }
            });
        }
    };
</script>
</body>
</html>