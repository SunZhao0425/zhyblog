## 私信

1. app 启动调用
/app/msglog/getTotalNotReadV1   

-> /system-message/get-all-count


私信

1. 关注的人
2. 未关注的人
3. 黑名单



39.106.102.182:5536


prvmsg/138214


a.app登陆时，通过新增php接口，固定取redis值，下行长连接地址。  (和谢老师确定一个redis 的key值 ) 解决
b.新增pc端发信和读信需要处理，保持原来的pc没有长连接不需要红点。 ( )
c.登陆哪里请求老接口php统计(3+1)个分类未读数，当长连接收到私信有新消息，再次请求老接口。
d.发私信时，在发成功IM后，改为php接口方便pc+2端同时通用，通知node服务器。
e.读私信时，每次请求php接口，通知node服务器。
f.删除(清空)私信，每次请求php接口，通知node服务器。

g.历史私信处理，如何过渡期？【用php，登陆时只拉取一次，通知node】
h.群发信息的处理？


新增两个接口 一个读私信接口 一个发私信接口


(获取redis中该用户的私信数)

c.登陆时，请求老php接口(最开始就有)统计(3+1，1为【新增】私信数，redis获取)个分类未读数  
d.当长连接收到私信有新消息，两端再次请求老php接口一次获取最新的(3+1，1为【新增】私信数，redis获取)未读数。

(发送私信 , 新增)

e.发私信时，在发成功IM后，【增加】php接口(之前方案是直接node通知客户端)方便pc+2端同时通用，操作reids，同时代码通知node服务器，node服务区器通过长连接告诉对方。


f.读私信时，【增加】php接口，操作redis。

g.删除(清空)私信，【增加】请求php接口，操作redis。


h.历史私信处理，如何过渡期？【用php，登陆时根据setbit只拉取一次，操作redis】

i.群发信息的处理？

redis设计
1.有一个setbit类型的key，存放用户是否拉取过im到node服务器
2.以用户id为key的set类型im消息ID集合。可以进行增加(发)、删除(读)、销毁(清空)操作
3.a.c.e.f.g php直接操作redis。



//用于Redis BIT类型存储的格式为二进制,销毁的内存和进程非常低,适用于统计某项数据的打开与关闭
//使用场景一：用户签到
//使用场景二：统计活跃用户
//使用场景三：用户在线状态


/comment/f-praise?subjectId=973447&businessId=2000&commentId=282679&statistics=android%7Csecalive-baidu%7C1.0%7Ced4f6eb73c954e88%7C5.1%7C862586039230417%7C4G%7C5.2.0%7C&token=b73342931e47149ffa58becf8f5fbf88*5546663


  
        //私信地址
        'nodemsgurl'=>
            [
                'master'=>[
                    'host'=>'172.16.10.101',
                    'port'=>'6379',
                    'password'=>'nNNsMFtpEbZpLEcVYjput7yanUUZfr5u',
                    'timeout'=>'3'
                ],
                'slaves'=>[
                    [
                        'host'=>'172.16.10.101',
                        'port'=>'6379',
                        'password'=>'nNNsMFtpEbZpLEcVYjput7yanUUZfr5u',
                        'timeout'=>'3'
                    ],
                ],
            ]



              //node server
    'nodeServer'=>[
        'socketIp'=>'192.168.2.13', //聊天默认服务器ip
        //红包使用的默认ip
        'redbagdefaultIp'=>'192.168.2.13', //是一台服务器
        'nodeHttpIp'=>'192.168.2.13',
        'esHttpIp'=>'192.168.2.13',//consumelogEsNode
        'socketMsgIp'=> '39.106.102.182' // 私信服务器Ip
    ],


    app 启动获取配置项 (nodeMsgUrl)
    http://192.168.2.248:3000/project/10/interface/api/855

    私信未读数(首页小红点)
    http://192.168.2.248:3000/project/13/interface/api/3248

    发私信
    http://192.168.2.248:3000/project/10/interface/api/3221

    读私信
    http://192.168.2.248:3000/project/10/interface/api/3230

    清空
    http://192.168.2.248:3000/project/10/interface/api/3239


北京朝阳区高碑店西店610号自创空间CBD写字园B1 

